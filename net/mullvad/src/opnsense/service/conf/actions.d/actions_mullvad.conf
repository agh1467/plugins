################################################################################
# Service Actions                                                              #
################################################################################

# [status]
# command:/usr/local/etc/rc.d/dnscrypt-proxy onestatus
# parameters:
# type:script_output
# message: dnscrypt-proxy: request status
# description: dnscrypt-proxy: Request status
#
# [start]
# command:/usr/local/etc/rc.d/dnscrypt-proxy onestart
# parameters:
# type:script
# message: dnscrypt-proxy: starting
# description: dnscrypt-proxy: Start service
#
# [stop]
# command:/usr/local/etc/rc.d/dnscrypt-proxy onestop
# parameters:
# type:script
# message: dnscrypt-proxy: stopping
# description: dnscrypt-proxy: Stop service
#
# [restart]
# command:/usr/local/etc/rc.d/dnscrypt-proxy onerestart
# parameters:
# type:script
# message: dnscrypt-proxy: restarting
# description: dnscrypt-proxy: Restart service

################################################################################
# Command Functions                                                            #
################################################################################

[login]
command:
    /usr/local/opnsense/scripts/OPNsense/Mullvad/account.py
#command: echo '{"device_name": "winged buffalo","ipv4_address": "10.67.122.255/32","ipv6_address": "fc00:bbbb:bbbb:bb01::4:7afe/128","private_key": "SDd3s/22ixkhCMNjewibkPUE/Rj17JoS8dmfxsx9Y0o=","public_key": "ccHOGyAuDW7sgaNa8o6UyiLFr2M52RjkZWwnMLUqFi4=","result": "success"}'
parameters: --login %s
type:script_output
message: mullvad: performing login for account: "%s"
description: mullvad: Perform login for account: "%s"

[logout]
command:
    /usr/local/opnsense/scripts/OPNsense/Mullvad/account.py
parameters: --logout %s
type:script_output
message: mullvad: performing login for account: "%s"
description: mullvad: Perform login for account: "%s"


[status]
#command: echo '{"account_status": "Expired on Jun 27, 2022 at 9:58 PM"}'
#command: echo '{"account_status": "Expired on Jun 27, 2022 at 9:58 PM"}'
command: echo '{"account_status": "Paid until Jun 27, 2022 at 9:58 PM"}'
parameters: # --status %s
#command:
#    /usr/local/opnsense/scripts/OPNsense/Mullvad/account.py
#parameters: --status %s
type:script_output
#message: mullvad: getting status for account: "%s"
#description: mullvad: Get status for account: "%s"

# [resolve]
# command:/usr/local/sbin/dnscrypt-proxy -child -config /usr/local/etc/dnscrypt-proxy/dnscrypt-proxy.toml -resolve
# parameters: %s
# type:script_output
# message: dnscrypt-proxy: resolving hostname: "%s"
# description: dnscrypt-proxy: Resolve hostname: "%s"
#
# [show-certs]
# command:/usr/local/sbin/dnscrypt-proxy -child -config /usr/local/etc/dnscrypt-proxy/dnscrypt-proxy.toml -show-certs
# parameters:
# type:script_output
# message: dnscrypt-proxy: showing DoH cert chains
# description: dnscrypt-proxy: Show DoH cert chains
#
# [config-check]
# command:(/usr/local/sbin/dnscrypt-proxy -child -config /usr/local/etc/dnscrypt-proxy/dnscrypt-proxy.toml -check 2>&1;exit 0)
# parameters:
# type:script_output
# message: dnscrypt-proxy: performing config check
# description: dnscrypt-proxy: Use dnscrypt-proxy -check to validate dnscrypt-proxy.toml
#
# [version]
# command:/usr/local/sbin/dnscrypt-proxy -version
# parameters:
# type:script_output
# message: dnscrypt-proxy: showing version
# description: dnscrypt-proxy: Show version
#
# #######
# ### Needs to be changed to reflect true package name, not devel version. ##
# #######
# [plugin_version]
# command:/usr/sbin/pkg query %v os-dnscrypt-proxy-devel
# parameters:
# type:script_output
# message: dnscrypt-proxy: showing plugin version
# description: dnscrypt-proxy: Show plugin version

################################################################################
# Query Functions
################################################################################

# Uses python to execute dnscrypt-proxy, and encode output to json and returns.
# This retrieves from dnscrypt-proxy a list of the server names currently configured.
# This includes servers from sources, and also the [static] defined servers.
# Used by: server_names, disabled_server_names, [broken_implementations].fragments_blocked
# [get-resolvers]
# command:/usr/local/opnsense/scripts/OPNsense/Dnscryptproxy/get_resolvers.py
# parameters: %s
# type:script_output
# message: dnscrypt-proxy: getting resolvers "%s"
# description: dnscrypt-proxy: Get list of resolvers from dnscrypt-proxy, and return a json list of servers

# Uses python to look up sources file names (enabled only), to analyze the
# SDNS stamps to identify from the list of servers which ones are relays,
# and returns a json list.
# Used by: [anonymized_dns].via
# [get-relays]
# command:/usr/local/opnsense/scripts/OPNsense/Dnscryptproxy/get_relays.py
# parameters: %s
# type:script_output
# message: dnscrypt-proxy: get relays "%s"
# description: dnscrypt-proxy: Get relays from configured sources files, and return json list of relays

################################################################################
# Import functions
################################################################################

# [import-list]
# command:/usr/local/opnsense/scripts/OPNsense/Dnscryptproxy/import_list.py
# parameters: %s %s
# type:script_output
# message: dnscrypt-proxy: importing file "%s" "%s"
# description: dnscrypt-proxy: Perform validation on list, and imports if no errors occurred

# [import-doh-client-certs]
# command:/usr/local/opnsense/scripts/OPNsense/Dnscryptproxy/import_doh_client_certs.py
# parameters:
# type:script_output
# message: dnscrypt-proxy: importing local DoH certificates, and certificate keys
# description: dnscrypt-proxy: Import the DoH client certificates, and client certificate keys from the config

################################################################################
# Export functions
################################################################################

# [export-blocked_names_file_manual]
# command:/bin/cat /usr/local/etc/dnscrypt-proxy/blocked-names-manual.txt
# parameters:
# type:script_output
# message: dnscrypt-proxy: exporting blocked-names-manual.txt
# description: dnscrypt-proxy: Export the blocked-names-manual.txt file to stdout
#
# [export-blocked_ips_file_manual]
# command:/bin/cat /usr/local/etc/dnscrypt-proxy/blocked-ips-manual.txt
# parameters:
# type:script_output
# message: dnscrypt-proxy: exporting blocked-ips-manual.txt
# description: dnscrypt-proxy: Export the blocked-ips-manual.txt file to stdout
#
# [export-allowed_names_file_manual]
# command:/bin/cat /usr/local/etc/dnscrypt-proxy/allowed-names-manual.txt
# parameters:
# type:script_output
# message: dnscrypt-proxy: exporting allowed-names-manual.txt
# description: dnscrypt-proxy: Export the allowed-names-manual.txt file to stdout
#
# [export-allowed_ips_file_manual]
# command:/bin/cat /usr/local/etc/dnscrypt-proxy/allowed-ips-manual.txt
# parameters:
# type:script_output
# message: dnscrypt-proxy: exporting allowed-ips-manual.txt
# description: dnscrypt-proxy: Export the allowed-ips-manual.txt file to stdout
#
# [export-cloaking_file_manual]
# command:/bin/cat /usr/local/etc/dnscrypt-proxy/cloaking-manual.txt
# parameters:
# type:script_output
# message: dnscrypt-proxy: exporting cloaking-manual.txt
# description: dnscrypt-proxy: Export the cloaking-manual.txt file to stdout

################################################################################
# Remove functions
################################################################################

# [remove-blocked_names_file_manual]
# command:/bin/rm /usr/local/etc/dnscrypt-proxy/blocked-names-manual.txt
# parameters:
# type:script
# message: dnscrypt-proxy: removing blocked-names-manual.txt
# description: dnscrypt-proxy: Remove the blocked-names-manual.txt file
#
# [remove-blocked_ips_file_manual]
# command:/bin/rm /usr/local/etc/dnscrypt-proxy/blocked-ips-manual.txt
# parameters:
# type:script
# message: dnscrypt-proxy: removing blocked-ips-manual.txt
# description: dnscrypt-proxy: Remove the blocked-ips-manual.txt file
#
# [remove-allowed_names_file_manual]
# command:/bin/rm /usr/local/etc/dnscrypt-proxy/allowed-names-manual.txt
# parameters:
# type:script
# message: dnscrypt-proxy: removing allowed-names-manual.txt
# description: dnscrypt-proxy: Remove the allowed-names-manual.txt file
#
# [remove-allowed_ips_file_manual]
# command:/bin/rm /usr/local/etc/dnscrypt-proxy/allowed-ips-manual.txt
# parameters:
# type:script
# message: dnscrypt-proxy: removing allowed-ips-manual.txt
# description: dnscrypt-proxy: Remove the allowed-ips-manual.txt file
#
# [remove-cloaking_file_manual]
# command:/bin/rm /usr/local/etc/dnscrypt-proxy/cloaking-manual.txt
# parameters:
# type:script
# message: dnscrypt-proxy: removing cloaking-manual.txt
# description: dnscrypt-proxy: Remove the cloaking-manual.txt file.

################################################################################
# View functions
################################################################################

# [config-view]
# command:/usr/local/opnsense/scripts/OPNsense/Dnscryptproxy/view_config.py
# parameters: %s
# type:script_output
# message: dnscrypt-proxy: viewing dnscrypt-proxy configuration files
# description: dnscrypt-proxy: View various configuration files for dnscrypt-proxy

################################################################################
# Logs functions
################################################################################

# [log.read]
# command:/usr/local/opnsense/scripts/OPNsense/Dnscryptproxy/log.py
# parameters: --log %s --filter %s --limit %s --offset %s
# type:script_output
# message: dnscrypt-proxy: parse dnscrypt-proxy "%s" log file
# description: dnscrypt-proxy: Parsing"%s" log file for dnscrypt-proxy
#
# [log.clear]
# command:/usr/local/opnsense/scripts/OPNsense/Dnscryptproxy/log.py
# parameters: --log %s --clear %s
# type:script_output
# message: dnscrypt-proxy: clear dnscrypt-proxy "%s" log file
# description: dnscrypt-proxy: Clearing "%s" log file for dnscrypt-proxy
